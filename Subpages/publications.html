<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../style.css"/>
        <title> My First Webpage</title>
    </head>
    <p style="position: relative; top: 50%;">
        <a href="../index.html">HOME</a> &nbsp;&nbsp; 
        <a href="tests.html">Test Page here!</a>  &nbsp;&nbsp; 
        <a href="team.html">Team </a> &nbsp;&nbsp;
        <a href="projekte.html">Projekte</a> &nbsp;&nbsp; 
        <a href="publications.html">Publikationen</a> &nbsp;&nbsp; 
        zu <a href="https://catma.de" style="color:black">CATMA</a> &nbsp;&nbsp; 
        zu <a href="https://fortext.net">forTEXT</a> &nbsp;&nbsp; 

    <HR NOSHADE="noshade">
    <body>
        
        <h1 style="text-align: center;"> Publikationen <br></h1>
        <img  style="margin-left: 20%;
        max-width:60%;height:auto;" src="../teambild.jpg"> 
        </br>

        <h2> CATMA<br/></h2>
        <style>
          .italic {
            font-style: italic;
          }
        </style>
      <!--body style="border-left: 5cm;text-align: center;"-->
      
      <script>// Setzen Sie Ihren API-Schlüssel und Ihre Bibliotheks-ID hier ein
          /**  var apiKey = 'Njmwb0MPtJRSVSgyysrwy9jr';
            var libraryId = '7427590';
            var collectionId= '47PCCWNR';
           
           **/ var url = 'https://api.zotero.org/users/'+libraryId+'/collections/'+collectionId+'/items?format=json&key='+apiKey+ '&limit=100';
       //https://www.zotero.org/momamari/collections/2XU3799V/items?format=json&key=Njmwb0MPtJRSVSgyysrwy9jr
          var apiKey = 'QrDAC57esCVVLi1EaMRg8OJE';
          var libraryId = '538260';
          var groupID = '1547948'; // Gruppen-ID hier einfügen
          var collectionId= '2CYW56EE';
          
         // var url = 'https://api.zotero.org/groups/'+groupID+'/collections/'+collectionId+'/items?format=json&key='+apiKey;
      //https://www.zotero.org/groups/1547948/collections/2CYW56EE/items?format=bib&key=QrDAC57esCVVLi1EaMRg8OJE **/
      
          var baseUrl = 'https://api.zotero.org/groups/' + groupID + '/collections/' + collectionId + '/items';
          var allData = []; // Array zur Speicherung aller Einträge
      
          function fetchData(page) {
          var url = baseUrl + '?format=json&key=' + apiKey + '&limit=100&start=' + (page * 100);
      
          // Rufen Sie die Daten von der Zotero-API ab
          fetch(url)
            .then(response => response.json())
            .then(data => {
              // Füge die aktuellen Einträge dem allData-Array hinzu
              allData = allData.concat(data);
      
              // Überprüfe, ob weitere Seiten vorhanden sind
              if (data.length === 100) {
                // Rufe die nächste Seite ab
                fetchData(page + 1);
              } else {
                // Keine weiteren Seiten vorhanden, verarbeite die gesammelten Daten
                processData(allData);
              }
            })
            .catch(error => console.error(error));
        }
        
        // Funktion zum Verarbeiten der gesammelten Daten
        function processData(data) {
          var entriesByYear = {};
          var publicationCount = data.length; // Anzahl der Publikationen
      
          // Restlicher Code zur Gruppierung der Daten nach Jahr und Anzeige
      
        // Durchlaufen Sie die Daten und gruppieren Sie sie nach Jahr
        for (var i = 0; i < data.length; i++) {
          var item = data[i];
          var date = item.data.date;
          if (!date) continue; // Skip entries without a date
          
         
      
          var year = getYearFromDate(date);
          if (!year) continue; // Skip entries with an invalid date
      
          var authors = item.data.creators.map(creator => creator.lastName + ", " + creator.firstName);
          var title = item.data.title;
          var publisher = item.data.publisher;
          var place = item.data.place;
          var type = item.data.itemType;
          var journal = item.data.journal;
          var container = item.data.container;
          var booktitle = item.data.publication;
          var series = item.data.series;
          var pages = item.data.pages;
      
          
          
      
          // Erstellen Sie den Eintrag im Chicago-Stil basierend auf der Eintragsart
          // Erstellen Sie den Eintrag im Chicago-Stil basierend auf der Eintragsart
      var entry = '';
      if (type === 'book') {
        entry = authors.join(', ') + '. ' + year + '. ' + title + '. ' + place + ': ' + publisher + '.';
      } else if (type === 'journalArticle') {
        var container = item.data.containerTitle;
        var journal = item.data.publicationTitle;
        var volume = item.data.volume;
        
      
        var doi = item.data.DOI;
        var edition = item.data.collectionNumber;
        
        if (pages in data && edition in data){
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". <span class="italic">' + journal + '</span>. ' + volume+"("+edition+")" + pages +". DOI: "+doi;
        } else if (pages in data && !(edition in data)){
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". <span class="italic">' + journal + '</span>. ' + volume+ "("+edition+")" +". DOI: "+doi;
        } else {
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". <span class="italic">' + journal + '</span> ' +". DOI: "+doi;
      
        }
      } else if (type === 'conferencePaper') {
        var series = item.data.series;
      //  var booktitle = item.data.bookTitle;
      //  var container = item.data.containerTitle;
      //  var journal = item.data.publicationTitle;
        var proceedings = item.data.proceedingsTitle;
        var url = item.data.url;
        var doi = item.data.DOI;
        if (pages in data && doi in data){
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". In <span class="italic">' + proceedings +"</span>, "+ pages + '.' +place + ". DOI: "+ doi + '.';
        } else if (pages in data && !(doi in data)) {
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". In <span class="italic">' + proceedings +"</span>. " +place +". " + url +".";
        } else if (!(doi in data )){
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". In <span class="italic">' + proceedings +"</span>. " +place +". "+ "DOI: "+ doi + '.';
        } else {
          entry = authors.join(', ') + '. ' + year + '. "' + title + '". In <span class="italic">' + proceedings +"</span>. " +place +".";
      
        }
      } else {
        //buchteil wird als conferencepaper gelesen
        var url = item.data.url;
        entry = authors.join(', ') + '. ' + year + '. "' + title + '". In <span class="italic">' + series +"</span>, "+ pages + ". " + place + ": " + publisher + ". " + url + '.';
      }
      
      
      
      
          // Fügen Sie den Eintrag dem entsprechenden Jahr im Dictionary hinzu
          if (!(year in entriesByYear)) {
            entriesByYear[year] = [entry];
          } else {
            entriesByYear[year].push(entry);
          }
        }
      
      
          // Gib die Summe der Publikationen aus
          var sumHeader = document.createElement('h2');
          sumHeader.innerText = 'Summe der Publikationen: ' + publicationCount;
          sumHeader.style.paddingLeft = '3em';
          document.body.prepend(sumHeader); // Am Anfang des Dokuments einfügen
        
      
      
        // Iterieren Sie über das Dictionary und geben Sie die Einträge aus
        Object.keys(entriesByYear)
        .sort((a, b) => b - a) // Sortieren Sie die Jahre absteigend
        .forEach(function(year) {
          var yearHeader = document.createElement('h2');
          yearHeader.innerText = year;
          yearHeader.style.paddingLeft = '11em';
          document.body.appendChild(yearHeader);
      
          var entries = entriesByYear[year];
          var uniqueEntries = [...new Set(entries)];
          uniqueEntries.sort();
          uniqueEntries.forEach(function(entry) {
            var entryParagraph = document.createElement('p');
            entryParagraph.innerHTML = entry;
            entryParagraph.style.paddingLeft = '20em';
            entryParagraph.style.paddingRight = '10em';
            document.body.appendChild(entryParagraph);
          });
      
        });
        }
      
      
      
        // Funktion zum Extrahieren des Jahres aus verschiedenen Datumsformaten
        function getYearFromDate(dateString) {
        var dateParts = dateString.split(/[^\d]+/);
        var year = dateParts.find(part => part.length === 4);
        
        if (year) {
          return year;
        }
        
        var possibleYear = parseInt(dateParts[dateParts.length - 1]);
        if (!isNaN(possibleYear)) {
          return possibleYear.toString();
        }
        
        return "Forthcoming";
      
        var attributes = Object.keys(data);
      for (var i = 0; i < attributes.length; i++) {
        var attributeName = attributes[i];
        var attributeValue = data[attributeName];
        console.log(attributeName + ": " + attributeValue);
      }
      
      }
      
      fetchData(0);
      
      
      
      </script>
      
      
      
        <p> Description
        </p>
        <h2> forTEXT-Portal<br/></h2>
        <p> Descirption
        </p>
        <h2>forTEXT Hefte<br/></h2>
        <p>Desciription</p>
        <br>
        <h2>EvENT<br/></h2>
        <p>Desciription</p>       
        <br>
        <h2>PLANS<br/></h2>
        <p>Desciription</p>       
        <br>
        <h2>Konflikte<br/></h2>
        <p></p>       
        <br>
        <h2>KatKit<br/></h2>
        <p></p>       
        <br>
        <h2> Szenen<br/></h2>
        <p>Desciription</p>       
        <br>
        <h2> Szenen<br/></h2>
        <p>Desciription</p>       
        <br>
        <h2> d-Prose<br/></h2>
        <p>Desciription</p>       
        <br>
        <h2> JCLS<br/></h2>
        <p>Desciription</p>       
        <br>
       

        <br>
        <h2> GO TO</h2>
       
        <p style="position: relative; left:10%">
            <a href="../index.html">HOME</a>
            <a href="tests.html">Test Page here!</a><br/>
            <a href="team.html">Team </a><br/>
            <!-- <button> Publications </button><br-->
            <a href="projekte.html">Projekte</a><br/>
            <a href="publications.html">Publikationen</a><br/>
            zu <a href="https://catma.de" style="color:black">CATMA</a><br>
            zu <a href="https://fortext.net">forTEXT</a><br>
            
        </p>
        <br>
        <br>
      

    </body>
    <script src="app.js"></script>
    
    <!--<img src="../fortext_logo.png" width="100" height= "auto" style="text-align:left;">-->
</html>